general {
    lock_cmd = omarchy-lock-screen                                                    # lock screen and 1password
    before_sleep_cmd = loginctl lock-session                                          # lock before suspend.
    after_sleep_cmd = hyprctl dispatch dpms on                                        # to avoid having to press a key twice to turn on the display.
    # make sure that we switch the display on incae user authenticated
    # with a fingerprint without pressing any key.
    # TODO: would be good to reset the idle state as well
    on_unlock_cmd = hyprctl dispatch dpms on && omarchy-restart-waybar                # prevent stacking of waybar when waking
    inhibit_sleep = 3                                                                 # wait until screen is locked
}

# make sure screen saver only starts when locker if not present
listener {
    timeout = 150                                             # 150s
    on-timeout = pidof hyprlock || omarchy-launch-screensaver
}

# only start the locker if screensaver is already running
# by doing this we can specify timeout < 20s which is
# the timeout of the screensaver normally
# we need that because screensaver spans a new terminal which
# causes hypridle to reset the idle state prematurarily.
listener {
    timeout = 150                                             # 150+150=300s
    on-timeout = hyprctl clients -j | jq -e '.[] | select(.class=="Screensaver")' >/dev/null && ! pidof hyprlock >/dev/null && loginctl lock-session
}

# also the locker resets the idle state when starting, thus
# we need to make sure we do not dim the screen if locker is not on.
listener {
    timeout = 30                                            # 150+150+30=330s
    on-timeout = pidof hyprlock >/dev/null && hyprctl dispatch dpms off               # screen off when timeout has passed
    on-resume = hyprctl dispatch dpms on                                              # screen on when activity is detected
}
